# 文章引用链接功能测试

## 功能说明
现在分析报告中的文章引用 `[1]`, `[2]` 等会自动转换为可点击的超链接。

**注意**：为了保持报告简洁，已移除底部的引用文章列表。用户只需点击内联的引用链接即可查看原文。

## 测试用例

### 测试报告示例 Markdown：
```markdown
# 加密货币市场分析报告

## 主要趋势

比特币价格持续上涨 [1]，以太坊也表现强劲 [2]。根据最新数据 [3]，市场情绪积极。

## 详细分析

### 技术面分析
- 比特币突破关键阻力位 [1]
- 链上数据显示积累趋势 [4]

### 市场情绪
投资者信心增强，这从多个指标可以看出 [2] [3]。

## 总结
综合以上分析 [1][2][3]，市场前景看好。

注意：这是一个 [普通的Markdown链接](https://example.com)，不应该被转换。
```

## 预期效果

1. **内联引用链接**
   - `[1]`, `[2]`, `[3]` 等会变成蓝色的可点击按钮
   - 鼠标悬停时显示外部链接图标
   - 鼠标悬停时显示文章标题和来源
   - 点击后在新标签页打开原文

2. **排除Markdown链接**
   - `[文字](url)` 格式的正常Markdown链接不受影响
   - 只转换 `[数字]` 格式且不带 `(url)` 的引用

3. **简洁设计**
   - ✅ 不在报告底部显示引用列表
   - ✅ 保持报告内容简洁清爽
   - ✅ 避免文章过多时页面过长

## 实际测试步骤

1. 启动后端和前端服务
2. 执行一键情报，生成分析报告
3. 在分析报告页面查看：
   - 文中的 `[1]`, `[2]` 是否变成可点击的蓝色按钮
   - 鼠标悬停是否显示外部链接图标和提示信息
   - 点击是否能正确跳转到原文
   - ✅ 确认页面底部没有引用文章列表

## 样式说明

### 引用按钮样式
- 背景色：浅蓝色 (`bg-blue-50`)
- 文字颜色：深蓝色 (`text-blue-700`)
- 边框：蓝色 (`border-blue-200`)
- 悬停效果：背景色加深 (`hover:bg-blue-100`)
- 内边距：`px-2 py-0.5`
- 圆角：`rounded`
- 字体：小号加粗 (`text-sm font-medium`)
- 无下划线：`no-underline`

## 技术实现

### 正则表达式
```javascript
// 匹配 [数字] 但排除 [数字](url) 格式
const refPattern = /\[(\d+)\](?!\()/g
```

### 负向前瞻
- `(?!\()` - 确保 `]` 后面不是 `(`
- 这样可以排除 Markdown 链接格式 `[文字](url)`
- 只匹配纯数字引用 `[1]`, `[2]` 等

### 性能优化
```typescript
// 使用 useMemo 缓存引用映射，避免每次渲染都重新计算
const refMap = useMemo(() => {
  const map = new Map<number, Article>()
  // ... 构建映射
  return map
}, [content, articles])
```

## 注意事项

1. **文章索引映射**
   - 引用序号 `[1]` 对应 `articles[0]`（数组索引从0开始）
   - 引用序号从1开始，符合人类阅读习惯
   - 超出范围的引用序号会保持原样不转换

2. **性能优化**
   - 使用 `useMemo` 缓存引用映射
   - 避免在每次渲染时重新解析
   - 依赖 `content` 和 `articles` 变化时才重新计算

3. **可访问性**
   - 使用语义化的 `<a>` 标签
   - 提供 `title` 属性显示悬停提示
   - 新标签页打开链接 (`target="_blank"`)
   - 添加安全属性 (`rel="noopener noreferrer"`)

## 设计决策

### 为什么移除底部引用列表？

1. **页面长度问题**
   - 当分析大量文章时（50+篇），引用列表会非常长
   - 影响用户阅读体验，需要大量滚动

2. **信息冗余**
   - 用户在阅读报告时，只需点击引用即可查看原文
   - 底部列表提供的信息（标题、来源）已经在 hover 提示中显示

3. **简洁优先**
   - 保持分析报告专注于内容本身
   - 减少视觉干扰
   - 提升阅读流畅性

## 后续优化建议

1. **引用预览**
   - 鼠标悬停时显示文章摘要气泡卡片
   - 显示文章的前200字内容
   - 包含发布时间、来源等元信息

2. **引用统计**
   - 在报告顶部显示引用文章总数
   - 例如："本报告基于 25 篇文章"

3. **可选的引用列表**
   - 添加一个折叠按钮："显示/隐藏引用文章"
   - 用户可以选择性地查看完整列表
   - 默认折叠，需要时展开

4. **键盘导航**
   - 支持 Tab 键导航引用链接
   - 支持快捷键快速跳转

